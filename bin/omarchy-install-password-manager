#!/bin/bash

if (($# == 0)); then
  echo "Usage: omarchy-install-password-manager [1password|bitwarden|keepassxc]"
  exit 1
fi

package="$1"

case $packages in
"bitwarden")
  omarchy-pkg-add bitwarden-desktop bitwarden-cli
  # Bitwarden package installs the executable with a different name
  ln -s /usr/bin/bitwarden-desktop /usr/bin/bitwarden
  ;;
"keepassxc")
  omarchy-pkg-add keepassxc
  if [[ ! -f ~/.config/keepassxc/keepassxc.ini ]]; then
    mkdir -p ~/.config/keepassxc/
    cp -Rpf $OMARCHY_PATH/config/keepassxc/keepassxc.ini ~/.config/keepassxc/keepassxc.ini
  fi
  ;;
*)
  omarchy-pkg-add $package
  ;;
esac

# Set as default password manager
echo "Setting $package as new default password manager..."
sed -i "/export PASSWORD_MANAGER=/ c\export PASSWORD_MANAGER=$package" ~/.config/uwsm/default

# Relaunch is needed for new default to take effect
echo
gum confirm "Relaunch Hyprland to use new password manager?" && uwsm stop
